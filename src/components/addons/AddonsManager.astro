---
import { allAddons } from '../../data/addons-data.js';
---

<div class="addons-manager">
	<!-- Sticky Controls Container -->
	<div> <!-- Removed sticky-controls class -->
		<!-- Simple Header -->
		<header class="manager-header">
			<div class="header-content">
				<h2 class="title">ğŸ“¦ Danh sÃ¡ch Add-ons</h2>
				<div class="stats">
					<span class="stat-item" id="total-count">0 add-ons</span>
					<span class="stat-item selected" id="selected-count">0 Ä‘Ã£ chá»n</span>
                </div>
			</div>
		</header>

		<!-- Enhanced Search & Filters -->
		<section class="search-section">
			<div class="search-bar">
				<div class="search-input-wrapper">
					<span class="search-icon">ğŸ”</span>
					<input
						type="search"
						id="search-input"
						placeholder="TÃ¬m kiáº¿m add-ons..."
						class="search-input"
					/>
					<button class="clear-btn" id="clear-search">Ã—</button>
            </div>
        </div>

			<div class="filter-controls">
				<select id="sort-select" class="filter-select">
					<option value="likes-desc">ğŸ“ˆ Phá»• biáº¿n nháº¥t</option>
					<option value="likes-asc">ğŸ“‰ Ãt phá»• biáº¿n</option>
					<option value="title-asc">ğŸ”¤ A-Z</option>
					<option value="title-desc">ğŸ”¤ Z-A</option>
					<option value="modified-desc">ğŸ†• Má»›i cáº­p nháº­t</option>
				</select>
				
				<select id="likes-filter" class="filter-select">
					<option value="">ğŸ‘ Táº¥t cáº£</option>
					<option value="10000">ğŸ‘ 10000+ thÃ­ch</option>
					<option value="5000">ğŸ‘ 5000+ thÃ­ch</option>
					<option value="1000">ğŸ‘ 1000+ thÃ­ch</option>
				</select>
				
				<button class="action-btn" id="toggle-view">
					<span class="btn-icon">âš</span>
					<span class="btn-text">Dáº¡ng tháº»</span>
				</button>
				
				<div class="export-group">
					<button class="action-btn export" id="export-btn">
						<span class="btn-icon">â¬‡</span>
						<span class="btn-text">Táº£i xuá»‘ng</span>
                                </button>
					<div class="export-menu hidden" id="export-menu">
						<button class="export-option" data-format="csv">
							ğŸ“Š CSV (Excel)
                                </button>
						<button class="export-option" data-format="txt-full">
							ğŸ“„ TXT Ä‘áº§y Ä‘á»§
                                </button>
						<button class="export-option" data-format="txt-links">
							ğŸ”— TXT chá»‰ links
                                </button>
            </div>
        </div>
</div>
		</section>
	</div>

	<!-- Content Display -->
	<main class="content-area">
		<!-- Loading -->
		<div class="loading-state hidden" id="loading">
			<div class="spinner"></div>
			<p>Äang táº£i...</p>
		</div>

		<!-- Table View -->
		<div class="table-view" id="table-view">
			<div class="table-header">
				<label class="select-all">
					<input type="checkbox" id="select-all">
					<span>Chá»n táº¥t cáº£</span>
				</label>
			</div>
			
			<div class="addon-list" id="addon-list">
				<!-- Items will be generated here -->
			</div>
		</div>

		<!-- Card View -->
		<div class="card-view hidden" id="card-view">
			<div class="card-grid" id="card-grid">
				<!-- Cards will be generated here -->
			</div>
		</div>

		<!-- Empty State -->
		<div class="empty-state hidden" id="empty-state">
			<div class="empty-icon">ğŸ˜”</div>
			<h3>KhÃ´ng tÃ¬m tháº¥y add-ons</h3>
			<p>Thá»­ thay Ä‘á»•i tá»« khÃ³a tÃ¬m kiáº¿m cá»§a báº¡n</p>
			<button class="action-btn" id="clear-filters">XÃ³a bá»™ lá»c</button>
		</div>
	</main>

	<!-- Selection Footer -->
	<footer class="selection-footer hidden" id="selection-footer">
		<div class="selection-info">
			<span class="selection-text" id="selection-text">0 add-ons Ä‘Ã£ chá»n</span>
		</div>
		<div class="selection-actions">
			<button class="sel-btn" id="open-all">ğŸ”— Má»Ÿ táº¥t cáº£</button>
			<button class="sel-btn export" id="export-selected">â¬‡ Xuáº¥t</button>
			<button class="sel-btn clear" id="clear-selection">Ã— Bá» chá»n</button>
		</div>
	</footer>
</div>

<style>
	@import '../../styles/addons-manager.css';
</style>

<script type="module" define:vars={{ allAddons }}>
	// Náº¡p script tá»« public (Ä‘Æ°á»£c copy nguyÃªn váº¹n khi build)
	const script = document.createElement('script');
	script.src = '/scripts/addons-manager.js';
	script.defer = true;
	script.onload = () => {
		try {
			console.log('Initializing SimpleAddonsManager from public script');
			new window.SimpleAddonsManager(allAddons);
		} catch (e) {
			console.error('Failed to init SimpleAddonsManager:', e);
		}
	};
	document.head.appendChild(script);
</script>
